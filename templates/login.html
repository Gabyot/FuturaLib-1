{% extends "layout.html" %}

{% block title %}
    Iniciar Sesión
{% endblock %}

{% block main %}
    <div class="text-center mb-4">
        <span>No tienes cuenta? </span>
        <a href="/register" class="text-primary">Regístrate aquí</a>
    </div>
    <form action="/login" method="post">
        <div class="mb-3">
            <input autocomplete="off" autofocus class="form-control mx-auto w-auto" id="rut" name="rut" placeholder="RUT" type="text" maxlength="12" required>
        </div>
        <div class="mb-3">
            <input class="form-control mx-auto w-auto" id="password" name="password" placeholder="Contraseña" type="password" required>
        </div>
        <button class="btn btn-primary" type="submit">Iniciar Sesión</button>
    </form>

    <script>
        function formateaRut(rut) {
            var actual = rut.replace(/[^0-9kK]/g, "").replace(/k/g, "K");

            if (actual != '' && actual.length > 1) {
                var sinPuntos = actual.replace(/\./g, "");
                var actualLimpio = sinPuntos.replace(/-/g, "");
                var inicio = actualLimpio.substring(0, actualLimpio.length - 1);
                var rutPuntos = "";
                var i = 0;
                var j = 1;
                for (i = inicio.length - 1; i >= 0; i--) {
                    var letra = inicio.charAt(i);
                    rutPuntos = letra + rutPuntos;
                    if (j % 3 == 0 && j <= inicio.length - 1) {
                        rutPuntos = "." + rutPuntos;
                    }
                    j++;
                }
                var dv = actualLimpio.substring(actualLimpio.length - 1);
                rutPuntos = rutPuntos + "-" + dv;
                return rutPuntos.substr(0, 12); // Asegurarse de que el RUT no exceda los 12 caracteres
            }
            return actual; // Retorna el RUT procesado si no es lo suficientemente largo
        }

        document.getElementById('rut').addEventListener('input', function() {
            this.value = formateaRut(this.value);
        });
    </script>
{% endblock %}
